<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ฝ่ายกิจการนักเรียน | โรงเรียนหนองกี่พิทยาคม จ.บุรีรัมย์</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Sarabun', sans-serif; 
            background: linear-gradient(135deg, #003d99 0%, #0052cc 50%, #003d99 100%);
            color: #1e40af; 
            scroll-behavior: smooth;
            min-height: 100vh;
        }

        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 800px; 
            margin: auto; 
            height: 300px; 
        }
        @media (min-width: 768px) { 
            .chart-container { height: 400px; } 
        }

        .glass-nav { 
            background: linear-gradient(90deg, rgba(0, 61, 153, 0.95) 0%, rgba(0, 82, 204, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 3px solid #fbbf24;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        /* Roster Styles */
        .roster-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-width: 2px;
            background: linear-gradient(135deg, #f8f9fa 0%, #f0f4ff 100%);
            border-color: #e5e7eb;
        }
        .roster-item.inactive { 
            filter: grayscale(0.6); 
            opacity: 0.7; 
            transform: scale(0.98);
        }
        .roster-item.inactive .day-icon {
            background-color: #9ca3af;
        }
        .roster-item.active { 
            transform: scale(1.08) translateY(-4px); 
            box-shadow: 0 25px 50px rgba(251, 191, 36, 0.35); 
            border-width: 3px;
            border-color: #fbbf24;
            background: linear-gradient(135deg, #ffffff 0%, #fffef0 100%);
            z-index: 10;
        }
        
        .loader { 
            border: 3px solid rgba(255, 255, 255, 0.3); 
            border-radius: 50%; 
            border-top: 3px solid #fbbf24; 
            width: 20px; 
            height: 20px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(71, 85, 105, 0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #fbbf24, #f59e0b); border-radius: 10px; }

        .step-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e5e7eb;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
        }

        .step-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0052cc, #fbbf24, #0052cc);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .step-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 82, 204, 0.2);
            border-color: #fbbf24;
        }

        .step-card:hover::before {
            opacity: 1;
        }

        .badge-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .gradient-text {
            background: linear-gradient(135deg, #0052cc 0%, #fbbf24 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .icon-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .submit-btn {
            background: linear-gradient(135deg, #0052cc 0%, #003d99 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid #fbbf24;
            box-shadow: 0 8px 20px rgba(0, 82, 204, 0.3);
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(251,191,36,0.4), transparent);
            transition: left 0.5s ease;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            box-shadow: 0 15px 40px rgba(0, 82, 204, 0.5);
            transform: translateY(-3px);
            border-color: #fcd34d;
        }

        .modal-content {
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            animation: fadeInUp 0.8s ease-out 0.1s both;
        }

        .main-desc {
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .step-card:nth-child(1) {
            animation: fadeInUp 0.8s ease-out 0.3s both;
        }

        .step-card:nth-child(2) {
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }

        .step-card:nth-child(3) {
            animation: fadeInUp 0.8s ease-out 0.5s both;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid #fbbf24;
            box-shadow: 0 15px 40px rgba(0, 82, 204, 0.15);
        }

        .shake {
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 glass-nav">
        <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://nongki.ac.th/np2019/img/home/logo_np.gif" alt="Logo โรงเรียนหนองกี่พิทยาคม" class="w-12 h-12 object-contain" onerror="this.onerror=null; this.src='https://via.placeholder.com/48?text=NP';">
                <div class="flex flex-col">
                    <span class="text-lg font-bold text-white leading-none">ฝ่ายกิจการนักเรียน</span>
                    <span class="text-xs text-yellow-200 font-medium">โรงเรียนหนองกี่พิทยาคม</span>
                </div>
            </div>
            
            <!-- Desktop Menu -->
            <div class="flex items-center gap-4">
                <button onclick="openAdminLogin()" class="hidden md:flex items-center gap-2 text-white hover:text-yellow-300 font-bold text-sm px-4 py-2 rounded-xl hover:bg-white/10 transition-all border border-white/20">
                    <i class="fa-solid fa-user-shield"></i>
                    <span>สำหรับเจ้าหน้าที่</span>
                </button>
                <button onclick="openModal()" class="submit-btn text-white px-6 py-2.5 rounded-full text-sm font-bold shadow-lg flex items-center gap-2 transition-all">
                    <i class="fa-solid fa-plus-circle"></i> <span>แจ้งเหตุ/ขอดูกล้อง</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-28 pb-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto mb-12 text-center">
            <h1 class="text-3xl md:text-5xl font-black text-white mb-6 tracking-tight">
                ระบบบริหารจัดการ <span class="gradient-text">ฝ่ายกิจการนักเรียน</span>
            </h1>
            <p class="main-desc text-yellow-100 max-w-3xl mx-auto text-sm md:text-base leading-relaxed mb-12">
                โรงเรียนหนองกี่พิทยาคมมุ่งเน้นความปลอดภัยของนักเรียนและบุคลากร โดยติดตั้งระบบกล้องวงจรปิดครอบคลุมพื้นที่อาคารเรียน สนามกีฬา และจุดเสี่ยงทั่วบริเวณโรงเรียน 
                เพื่อการตรวจสอบเหตุการณ์และรักษาความปลอดภัยอย่างมีประสิทธิภาพตลอด 24 ชั่วโมง
            </p>

            <!-- Info Steps Section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto">
                <!-- Step 1 -->
                <div class="step-card p-8 rounded-2xl relative overflow-hidden group">
                    <div class="absolute -top-4 -right-4 w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center text-blue-200 font-black text-5xl opacity-30">1</div>
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center text-white mb-6 shadow-lg">
                        <i class="fa-solid fa-pen-to-square text-2xl"></i>
                    </div>
                    <h3 class="font-black text-blue-900 mb-3 text-lg">ยื่นคำร้องออนไลน์</h3>
                    <p class="text-sm text-slate-700 leading-relaxed">กรอกข้อมูลรายละเอียดเหตุการณ์และจุดประสงค์การตรวจสอบผ่านระบบคำร้องออนไลน์</p>
                </div>
                <!-- Step 2 -->
                <div class="step-card p-8 rounded-2xl relative overflow-hidden group">
                    <div class="absolute -top-4 -right-4 w-20 h-20 bg-yellow-50 rounded-full flex items-center justify-center text-yellow-200 font-black text-5xl opacity-30">2</div>
                    <div class="w-14 h-14 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center text-white mb-6 shadow-lg">
                        <i class="fa-solid fa-phone-volume text-2xl"></i>
                    </div>
                    <h3 class="font-black text-blue-900 mb-3 text-lg">ประสานงานเจ้าหน้าที่</h3>
                    <p class="text-sm text-slate-700 leading-relaxed">ติดต่อประสานงานครูเวรประจำวันตามหมายเลขโทรศัพท์ที่ระบุ เพื่อขอนัดหมายเวลาเข้าตรวจสอบ</p>
                </div>
                <!-- Step 3 -->
                <div class="step-card p-8 rounded-2xl relative overflow-hidden group">
                    <div class="absolute -top-4 -right-4 w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center text-blue-200 font-black text-5xl opacity-30">3</div>
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-700 to-blue-800 rounded-xl flex items-center justify-center text-white mb-6 shadow-lg">
                        <i class="fa-solid fa-eye text-2xl"></i>
                    </div>
                    <h3 class="font-black text-blue-900 mb-3 text-lg">ดำเนินการตรวจสอบ</h3>
                    <p class="text-sm text-slate-700 leading-relaxed">เข้าดำเนินการตรวจสอบภาพจากกล้องวงจรปิด ณ ห้องปฏิบัติการ ตามวันและเวลาที่ได้นัดหมายไว้</p>
                </div>
            </div>
            
            <!-- Mobile Admin Link -->
            <div class="mt-8 md:hidden">
                <button onclick="openAdminLogin()" class="text-white font-bold text-sm underline flex items-center justify-center gap-1 hover:text-yellow-300">
                    <i class="fa-solid fa-lock"></i> เข้าสู่หน้าจัดการเจ้าหน้าที่
                </button>
            </div>
        </div>

        <div class="max-w-7xl mx-auto grid lg:grid-cols-3 gap-8">
            <!-- Analytics Section -->
            <div class="lg:col-span-2 fade-in-up">
                <div class="glass-card rounded-2xl p-8 shadow-2xl h-full flex flex-col">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-2xl font-black text-blue-900 flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-chart-column text-white"></i>
                            </div>
                            สถิติการแจ้งเหตุ
                        </h2>
                        <div class="flex items-center gap-3">
                            <span id="syncStatus" class="text-xs font-bold px-3 py-1.5 rounded-full bg-blue-100 text-blue-700 uppercase text-center min-w-[90px]">Checking...</span>
                            <button onclick="refreshData()" class="bg-blue-100 hover:bg-yellow-200 text-blue-700 p-2.5 rounded-full transition-all border border-blue-300" title="รีเฟรชข้อมูล">
                                <i class="fa-solid fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container flex-grow" id="chartWrapper">
                        <canvas id="dailyRequestsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Roster Section -->
            <div class="lg:col-span-1 fade-in-up">
                <div class="glass-card rounded-2xl p-5 h-full shadow-2xl overflow-hidden">
                    <h2 class="text-lg font-black text-blue-900 mb-4 border-b-2 border-yellow-400 pb-3 flex items-center gap-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-user-shield text-white text-sm"></i>
                        </div>
                        <span>ครูเวรประสานงาน</span>
                    </h2>
                    <div class="space-y-2 max-h-[500px] overflow-y-auto pr-2" id="roster-list">
                        <!-- Sunday (0) -->
                        <div id="day-0" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">อา</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายนราศักดิ์ เสาวยงค์</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>088-696-3536</p>
                            </div>
                        </div>
                        <!-- Monday (1) -->
                        <div id="day-1" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-yellow-500 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">จ</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายธนวิน เกิดประโคน</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>094-356-5879</p>
                            </div>
                        </div>
                        <!-- Tuesday (2) -->
                        <div id="day-2" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-blue-700 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">อ</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายธนวิน เกิดประโคน</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>094-356-5879</p>
                            </div>
                        </div>
                        <!-- Wednesday (3) -->
                        <div id="day-3" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">พ</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายนัตพล ชะเมรัมย์</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>065-390-4151</p>
                            </div>
                        </div>
                        <!-- Thursday (4) -->
                        <div id="day-4" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-yellow-500 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">พฤ</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายนัตพล ชะเมรัมย์</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>065-390-4151</p>
                            </div>
                        </div>
                        <!-- Friday (5) -->
                        <div id="day-5" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-blue-700 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">ศ</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายนราศักดิ์ เสาวยงค์</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>088-696-3536</p>
                            </div>
                        </div>
                        <!-- Saturday (6) -->
                        <div id="day-6" class="roster-item p-3 rounded-lg flex items-center gap-2 border">
                            <div class="day-icon w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-sm shrink-0 text-xs">ส</div>
                            <div class="flex-grow">
                                <p class="text-xs font-bold text-blue-900 leading-tight">นายนราศักดิ์ เสาวยงค์</p>
                                <p class="text-xs text-blue-600 font-mono"><i class="fa-solid fa-phone mr-1"></i>088-696-3536</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Form -->
    <div id="requestModal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-blue-900/70 backdrop-blur-md transition-opacity" onclick="closeModal()"></div>
            <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden transform transition-all modal-content border-2 border-yellow-400">
                <div class="bg-gradient-to-r from-blue-700 to-blue-600 px-8 py-6 flex justify-between items-center text-white">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-file-circle-plus text-2xl text-yellow-300"></i>
                        <h3 class="font-black text-xl">แบบฟอร์มแจ้งเหตุ / ขอดูกล้อง</h3>
                    </div>
                    <button onclick="closeModal()" class="hover:bg-white/20 p-2 rounded-full transition-colors">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>
                <div class="p-8 bg-blue-50">
                    <form id="cctvForm" class="space-y-6">
                        <input type="hidden" name="requestId" id="requestIdInput">
                        <input type="hidden" name="submissionDate" id="submissionDateInput">
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-sm font-black text-blue-900 ml-1">ชื่อ-นามสกุล ผู้แจ้ง</label>
                                <input type="text" name="fullName" required placeholder="เช่น นายสมชาย ใจดี" class="w-full border-2 border-blue-200 p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600 focus:border-yellow-400 transition-all bg-white">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-black text-blue-900 ml-1">ชั้น / ตำแหน่ง</label>
                                <input type="text" name="position" required placeholder="เช่น ม.6/1" class="w-full border-2 border-blue-200 p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600 focus:border-yellow-400 transition-all bg-white">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-sm font-black text-blue-900 ml-1">เบอร์โทรศัพท์ติดต่อ</label>
                                <input type="tel" name="phone" required placeholder="08x-xxx-xxxx" class="w-full border-2 border-blue-200 p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600 focus:border-yellow-400 transition-all bg-white">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-black text-blue-900 ml-1">วันที่ต้องการตรวจสอบ</label>
                                <input type="date" name="targetDate" required class="w-full border-2 border-blue-200 p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600 focus:border-yellow-400 transition-all bg-white">
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-black text-blue-900 ml-1">รายละเอียดเหตุการณ์ / จุดที่ขอดู</label>
                            <textarea name="details" rows="4" required placeholder="อธิบายเหตุการณ์ ช่วงเวลา และจุดที่ต้องการตรวจสอบ..." class="w-full border-2 border-blue-200 p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600 focus:border-yellow-400 transition-all resize-none bg-white"></textarea>
                        </div>

                        <button type="submit" id="submitBtn" class="submit-btn w-full text-white py-4 rounded-xl font-black flex items-center justify-center gap-3 shadow-xl">
                            <span id="btnLoader" class="loader hidden"></span>
                            <span id="btnText">ยืนยันการส่งคำร้อง</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminModal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-blue-900/70 backdrop-blur-md transition-opacity" onclick="closeAdminLogin()"></div>
            <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all modal-content border-2 border-yellow-400">
                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 px-8 py-6 flex justify-between items-center text-white">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-lock text-2xl"></i>
                        <h3 class="font-black text-xl">เข้าสู่ระบบเจ้าหน้าที่</h3>
                    </div>
                    <button onclick="closeAdminLogin()" class="hover:bg-white/20 p-2 rounded-full transition-colors">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>
                <div class="p-8 bg-blue-50">
                    <div class="mb-6 p-4 bg-yellow-50 rounded-xl border-2 border-yellow-200">
                        <p class="text-sm text-yellow-800 font-bold"><i class="fa-solid fa-key mr-2"></i>กรุณากรอกรหัสผ่านเพื่อเข้าสู่ระบบเจ้าหน้าที่</p>
                    </div>

                    <form id="adminLoginForm" class="space-y-4" onsubmit="handleAdminLogin(event)">
                        <div class="space-y-2">
                            <label class="text-sm font-black text-blue-900 ml-1">รหัสผ่าน</label>
                            <input type="password" id="adminPassword" placeholder="กรอกรหัสผ่าน..." required class="w-full border-2 border-yellow-300 p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-yellow-400 focus:border-yellow-500 transition-all bg-white">
                        </div>

                        <div id="passwordError" class="p-3 bg-red-50 border-2 border-red-300 rounded-xl text-red-700 text-sm font-bold hidden flex items-center gap-2">
                            <i class="fa-solid fa-exclamation-circle"></i>
                            <span>รหัสผ่านไม่ถูกต้อง</span>
                        </div>

                        <button type="submit" class="submit-btn w-full text-white py-3 rounded-xl font-black flex items-center justify-center gap-2 shadow-lg">
                            <i class="fa-solid fa-arrow-right"></i>
                            <span>เข้าสู่ระบบ</span>
                        </button>
                    </form>

                    <p class="text-center text-xs text-slate-500 mt-6">หากลืมรหัสผ่าน โปรดติดต่อครูหัวหน้าฝ่ายกิจการ</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxYxjZzOYpmsOC4mizwfagtVuUbgMLTPwuZ_aw_tfVDHIjVXOCQ5uS8K9zECDs1cUra2w/exec'; 
        let myChart;

        function openAdminLogin() {
            document.getElementById('adminModal').classList.remove('hidden');
            document.getElementById('adminPassword').focus();
            document.getElementById('passwordError').classList.add('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeAdminLogin() {
            document.getElementById('adminModal').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
            document.getElementById('passwordError').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function handleAdminLogin(event) {
            event.preventDefault();
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('passwordError');
            const modal = document.getElementById('adminModal');

            if (password === 'nongki') {
                sessionStorage.setItem('adminAuthenticated', 'true');
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                window.location.href = 'admin.html';
            } else {
                errorDiv.classList.remove('hidden');
                modal.classList.add('shake');
                document.getElementById('adminPassword').value = '';
                setTimeout(() => {
                    modal.classList.remove('shake');
                }, 400);
            }
        }

        document.getElementById('adminPassword')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleAdminLogin(e);
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !document.getElementById('adminModal').classList.contains('hidden')) {
                closeAdminLogin();
            }
        });

        async function refreshData() {
            const statusLabel = document.getElementById('syncStatus');
            statusLabel.innerText = "Syncing...";
            statusLabel.className = "text-xs font-bold px-3 py-1.5 rounded-full bg-blue-300 text-blue-900 uppercase animate-pulse min-w-[90px]";

            if (!scriptURL || scriptURL === 'YOUR_APPS_SCRIPT_URL_HERE') {
                renderChart(['15 ก.พ.', '16 ก.พ.', '17 ก.พ.'], [2, 5, 3]);
                statusLabel.innerText = "Mock Mode";
                statusLabel.className = "text-xs font-bold px-3 py-1.5 rounded-full bg-yellow-200 text-yellow-800 uppercase min-w-[90px]";
                return;
            }

            try {
                const response = await fetch(`${scriptURL}?action=getStats&t=${new Date().getTime()}`);
                const data = await response.json();
                if (data.result === 'success') {
                    renderChart(data.labels, data.values);
                    statusLabel.innerText = "Connected";
                    statusLabel.className = "text-xs font-bold px-3 py-1.5 rounded-full bg-green-200 text-green-800 uppercase min-w-[90px]";
                } else { throw new Error(data.error); }
            } catch (err) {
                statusLabel.innerText = "Sync Failed";
                statusLabel.className = "text-xs font-bold px-3 py-1.5 rounded-full bg-red-200 text-red-800 uppercase min-w-[90px]";
                renderMockChart();
            }
        }

        function renderChart(labels, values) {
            const ctx = document.getElementById('dailyRequestsChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'จำนวนการแจ้งเหตุ',
                        data: values,
                        backgroundColor: 'rgba(0, 82, 204, 0.9)',
                        borderColor: '#fbbf24',
                        borderWidth: 2,
                        borderRadius: 10,
                        maxBarThickness: 50
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false } 
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            ticks: { stepSize: 1, color: '#1e40af', font: { weight: 'bold' } },
                            grid: { color: 'rgba(0, 82, 204, 0.1)' }
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { color: '#1e40af', font: { weight: 'bold' } }
                        }
                    }
                }
            });
        }

        function renderMockChart() {
            renderChart(['15 ก.พ.', '16 ก.พ.', '17 ก.พ.'], [2, 5, 3]);
        }

        function generateId() {
            const lastId = localStorage.getItem('last_np_req_id') || 0;
            const newId = parseInt(lastId) + 1;
            localStorage.setItem('last_np_req_id', newId);
            return 'NP' + String(newId).padStart(4, '0');
        }

        function openModal() {
            document.getElementById('requestModal').classList.remove('hidden');
            document.getElementById('requestIdInput').value = generateId();
            document.getElementById('submissionDateInput').value = new Date().toISOString();
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('requestModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            document.getElementById('cctvForm').reset();
        }

        document.getElementById('cctvForm').addEventListener('submit', async e => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const loader = document.getElementById('btnLoader');
            const text = document.getElementById('btnText');

            if (!scriptURL || scriptURL === 'https://script.google.com/macros/s/AKfycbxYxjZzOYpmsOC4mizwfagtVuUbgMLTPwuZ_aw_tfVDHIjVXOCQ5uS8K9zECDs1cUra2w/exec') {
                alert('กรุณาตั้งค่า Script URL ก่อนครับ');
                return;
            }

            btn.disabled = true;
            loader.classList.remove('hidden');
            text.innerText = "กำลังส่งข้อมูล...";

            try {
                const response = await fetch(scriptURL, { method: 'POST', body: new FormData(e.target) });
                const result = await response.json();
                if (result.result === 'success') {
                    alert('ส่งคำร้องสำเร็จ!');
                    closeModal();
                    setTimeout(refreshData, 2000); 
                } else { throw new Error(result.error); }
            } catch (err) { alert('เกิดข้อผิดพลาด: ' + err.message); }
            finally {
                btn.disabled = false;
                loader.classList.add('hidden');
                text.innerText = "ยืนยันการส่งคำร้อง";
            }
        });

        function updateRosterHighlight() {
            const today = new Date().getDay(); 
            document.querySelectorAll('.roster-item').forEach(item => {
                const dayId = parseInt(item.id.split('-')[1]);
                if (dayId === today) {
                    item.classList.remove('inactive');
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                    item.classList.add('inactive');
                }
            });
        }

        window.onload = () => {
            updateRosterHighlight();
            refreshData();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cf56b6a968da18c',t:'MTc3MTMzMjcyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
